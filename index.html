<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CraZyPG</title>
    <style>
        html, body {
            background: black;
            padding: 0px;
            margin: 0px;
            width: 100%;
            height: 100%;
        }
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        div {
            display: flex;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div>
        <canvas id="glpaper"></canvas>
    </div>
    <script src="./gl.js"></script>
    <script src="./Shader.js"></script>
    <script id="v-shader" type="shader">#version 300 es
        in vec3 a_Position;
        in vec3 a_Color;

        uniform float u_PointSize;
        out vec3 v_Color;
        void main() {
            v_Color = a_Color;
            gl_PointSize = u_PointSize;
            gl_Position = vec4(a_Position, 1.0);
        }
    </script>
    <script id="f-shader" type="shader">#version 300 es
        precision mediump float;

        in vec3 v_Color;
        out vec4 finalColor;

        void main() {
            finalColor = vec4(v_Color, 1.0);
        }
    </script>
    <script>
        CZPG.getContext('glpaper').setSize('400px', '300px', window.devicePixelRatio).clear();

        let gl = CZPG.gl;
        let prog = ShaderUtil.createProgram(gl, 'v-shader', 'f-shader');
        
        gl.useProgram(prog);
        let aLocation = gl.getAttribLocation(prog, 'a_Position');
        let cLocation = gl.getAttribLocation(prog, 'a_Color');
        let uLocation = gl.getUniformLocation(prog, 'u_PointSize');
        gl.useProgram(null);

        let positionArray = new Float32Array([0, 0, 0, 0.5, -0.5, 0]);
        let positionBuffer = CZPG.createArrayBuffer(positionArray);

        let colorArray = new Float32Array([1.0, 0, 0, 0, 1.0, 0]);
        let colorBuffer = CZPG.createArrayBuffer(colorArray);

        gl.useProgram(prog);
        gl.uniform1f(uLocation, 30.0);

        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
        gl.enableVertexAttribArray(aLocation);
        gl.vertexAttribPointer(aLocation, 3, gl.FLOAT, false, 0, 0);
        gl.bindBuffer(gl.ARRAY_BUFFER, null);

        gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);
        gl.enableVertexAttribArray(cLocation);
        gl.vertexAttribPointer(cLocation, 3, gl.FLOAT, false, 0, 0);
        gl.bindBuffer(gl.ARRAY_BUFFER, null);

        gl.drawArrays(gl.POINTS, 0, 2);
    </script>
</body>
</html>