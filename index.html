<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CraZyPG</title>
    <style>
        html, body {
            background: black;
            padding: 0px;
            margin: 0px;
            width: 100%;
            height: 100%;
        }

        div#canvas {
            display: flex;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
        }

        div#container{
            width: 100%;
            height: 100%;
        }

        div#footbar{
            position: absolute;
            bottom: 0px;
            right: 20px;
            padding: 10px;
            font-size: 11px;
            font-family: 'Raleway', 'Helvetica', sans-serif;
            color: #222222;
            font-weight: 700;
        }

        div#footbar a{
            color: #44ABDA
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas">
            <canvas id="glpaper"></canvas>
        </div>
    </div>
    <div id="footbar">
        <p><a href="https://github.com/PrincessGod/CraZyPG">CZPG.js</a></p>
    </div>
    <script src="./build/czpg.js"></script>
    <script>
        window.addEventListener('load', function() {
            const renderer = new CZPG.Renderer('glpaper', { antialias: true }).setSize('80%', '80%').clear();
            const context = renderer.context;
            const scene = new CZPG.Scene(renderer);

            textures = CZPG.createTextures(context, {
                scalar: {
                    src : './resource/UV_Grid_Lrg.jpg',
                    min : context.LINEAR_MIPMAP_LINEAR,
                    mag : context.LINEAR,
                },
                day: {
                    target: context.TEXTURE_CUBE_MAP,
                    src: [
                        './resource/miramar_right.png',
                        './resource/miramar_left.png',
                        './resource/miramar_top.png',
                        './resource/miramar_bottom.png',
                        './resource/miramar_back.png',
                        './resource/miramar_front.png',
                    ]
                },
                night: {
                    target: context.TEXTURE_CUBE_MAP,
                    src: [
                        './resource/grimmnight_right.png',
                        './resource/grimmnight_left.png',
                        './resource/grimmnight_top.png',
                        './resource/grimmnight_bottom.png',
                        './resource/grimmnight_back.png',
                        './resource/grimmnight_front.png',
                    ]
                },
            })

            let camera = new CZPG.OrthographicCamera(10, context.canvas.width/context.canvas.height);
            // let camera = new CZPG.PerspectiveCamera(45, context.canvas.width/context.canvas.height);
            camera.transform.position.set(1.5, 4, 1.5);
            camera.updateViewMatrix();
            let controler = scene.controler;
            let cameraControler = new CZPG.OrbitControls(camera, context.canvas, controler);
            cameraControler.enableDamping = true;
            cameraControler.autoRotate = true;

            let cubeModel = CZPG.Cube.createModel();
            let shader = new CZPG.FlatTextureShader(context, camera, textures.scalar);

            let gridShader = new CZPG.GridAxisShader(context, camera);
            let gridModal = CZPG.GridAxis.createModel()

            scene.add([
                {shader: shader, model: cubeModel},
                {shader: gridShader, model: gridModal},
            ]);

            context.blendFunc(context.ONE, context.ONE);
            let resized = false;
            let loop = new CZPG.Render(function(timespan) {
                resized = renderer.clear(0.0, 0.0, 0.0, 1.0).fixCanvasToDisplay(window.devicePixelRatio)
                if(resized) camera.updateProjMatrix( context.canvas.width / context.canvas.height );
                cameraControler.update();
                scene.render();
            }).start();

        });

    </script>
</body>
</html>