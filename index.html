<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CraZyPG</title>
    <style>
        html, body {
            background: black;
            padding: 0px;
            margin: 0px;
            width: 100%;
            height: 100%;
        }

        div#canvas {
            display: flex;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
        }

        div#container{
            width: 100%;
            height: 100%;
        }

        div#footbar{
            position: absolute;
            bottom: 0px;
            right: 20px;
            padding: 10px;
            font-size: 11px;
            font-family: 'Raleway', 'Helvetica', sans-serif;
            color: #222222;
            font-weight: 700;
        }

        div#footbar a{
            color: #44ABDA
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas">
            <canvas id="glpaper"></canvas>
        </div>
    </div>
    <div id="footbar">
        <p><a href="https://github.com/PrincessGod/CraZyPG">CZPG.js</a></p>
    </div>
    <script src="./build/czpg.js"></script>
    <script src="./sample/js/dat.gui.min.js"></script>
    <script id="vs" type="shader-vs">
    #version 300 es
    in  vec3 position;
    in  vec4 color;
    in  vec2 uv;

    out vec4 vColor;
    out vec2 vUv;

    void main() {
        vColor = color;
        vUv = uv;
        gl_Position = vec4(position, 1.0);
    }
    </script>
    <script id="fs" type="shader-fs">
    #version 300 es
    precision mediump float;

    in vec4 vColor;
    in vec2 vUv;

    uniform sampler2D u_texture;

    out vec4 fragColor;

    void main() {
        fragColor = mix(texture(u_texture, vUv), vColor, 0.5);
    }
    </script>
    <script>

        window.addEventListener('load', function() {
            window.ren = new CZPG.WebGLRenderer('glpaper');

            window.texs = new CZPG.Textures(ren.context);
            window.tex = new CZPG.Texture2D( { src: './resource/UV_Grid_Lrg.jpg' } );
            let texture = texs.update(tex.textureInfo).get(tex.textureInfo);

            const positions = [
                -0.5, 0.5, 0.0, // v0
                0.5, 0.5, 0.0, // v1
                -0.5,-0.5, 0.0, // v2
                0.5,-0.5, 0.0  // v3
            ];
            const uvs = [
                0, 0,
                1, 0,
                0, 1,
                1, 1,
            ]
            const colors = [
                1.0, 0.0, 0.0, 1.0, // v0
                0.0, 1.0, 0.0, 1.0, // v1
                0.0, 0.0, 1.0, 1.0, // v2
                1.0, 1.0, 0.0, 1.0  // v3
            ];
            const indices = [
                2, 1, 0, // v2-v1-v0
                2, 3, 1  // v2-v3-v1
            ];

            const attribArrays = {
                indices: { data: indices },
            };
            attribArrays['position'] = { data: positions, numComponents: 3 };
            attribArrays['uv'] = { data: uvs, numComponents: 2 };
            attribArrays['color'] = { data: colors, numComponents: 4 };
            // window.pr = new CZPG.Primitive(attribArrays, {name:'tt'});
            window.mo = new CZPG.Model(attribArrays, {name: 't2'});
            window.pro = new CZPG.Shader( 'vs', 'fs' );
            ren.setSize( '100%', '100%' ).fixCanvasToDisplay(window.devicePixelRatio);
            ren.render(pro.setUniformObj({u_texture:texture}), mo);

            setTimeout(()=>{texs.update(tex.textureInfo); ren.render(pro, mo);}, 1000);

        });

    </script>
</body>
</html>