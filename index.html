<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CraZyPG</title>
    <style>
        html, body {
            background: black;
            padding: 0px;
            margin: 0px;
            width: 100%;
            height: 100%;
        }

        div#canvas {
            display: flex;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
        }

        div#container{
            width: 100%;
            height: 100%;
        }

        div#footbar{
            position: absolute;
            bottom: 0px;
            right: 20px;
            padding: 10px;
            font-size: 11px;
            font-family: 'Raleway', 'Helvetica', sans-serif;
            color: #222222;
            font-weight: 700;
        }

        div#footbar a{
            color: #44ABDA
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas">
            <canvas id="glpaper"></canvas>
        </div>
    </div>
    <div id="footbar">
        <p><a href="https://github.com/PrincessGod/CraZyPG">CZPG.js</a></p>
    </div>
    <script src="./build/czpg.js"></script>
    <script src="./sample/js/dat.gui.min.js"></script>
    <script id="vs" type="shader-vs">
    #version 300 es
    in  vec3 position;
    in  vec4 color;
    in  vec2 uv;

    out vec4 vColor;
    out vec2 vUv;

    uniform mat4 u_modelMat;
    uniform mat4 u_viewMat;
    uniform mat4 u_projMat;

    void main() {
        vColor = color;
        vUv = uv;
        gl_Position = u_projMat * u_viewMat * u_modelMat * vec4(position, 1.0);
    }
    </script>
    <script id="fs" type="shader-fs">
    #version 300 es
    precision mediump float;

    in vec4 vColor;
    in vec2 vUv;

    uniform sampler2D u_texture;

    out vec4 fragColor;

    void main() {
        fragColor = mix(texture(u_texture, vUv), vColor, 0.5);
    }
    </script>
    <script>

        class TestShader extends CZPG.RawShader {

            constructor() {

                super('vs', 'fs');

            }

        }

        class TestMaterial extends CZPG.Material {

            constructor( opts ) {

                super(TestShader, opts);

            }

        }

        window.addEventListener('load', function() {
            window.renderer = new CZPG.WebGL2Renderer('glpaper').setSize( '100%', '100%' );
            window.scene = new CZPG.Scene( renderer );
            window.tex = new CZPG.Texture2D( { src: './resource/UV_Grid_Lrg.jpg' } );
            window.camera = new CZPG.PerspectiveCamera(45, renderer.canvas.width / renderer.canvas.height);

            let cameraControler = new CZPG.OrbitControls(camera, renderer.canvas, scene.controler);
            cameraControler.enableDamping = true;
            camera.position = [0, 0, 10];

            const ambientLight = new CZPG.AmbientLight( [.1, .1, .1], 0.1 );
            const directLight = new CZPG.DirectionalLight( [1, 1, 1], 0.1 );
            const pointLight = new CZPG.PointLight( [1, 1, 1], 1, 10 );
            const spotLight = new CZPG.SpotLight( [1, 0, 0], 1, 0, Math.PI / 8, 0.8 ); spotLight.position = [0, 5, 0]; spotLight.rotation = [Math.PI / 2, 0, 0];
            scene.add( ambientLight, directLight, pointLight, spotLight);

            const quadMaterial = new CZPG.BasicModelMaterial({baseColor: [1, 0, 0, 1], baseTexture: tex});
            const lambertMaterial = new CZPG.LambertModelMaterial({ baseColor: [1, 0, 0, 1], baseTexture: tex, cull:false });
            const model = new CZPG.Model(new CZPG.Quad({offset: 0, size: 5}), lambertMaterial);
            model.rotation = [-Math.PI / 2, 0, 0];
            scene.add(model);

            const cube = new CZPG.Model( new CZPG.Cube({ offset: 0 }), lambertMaterial );
            cube.position = [1, 0, 0];
            scene.add(cube);

            const sphere = new CZPG.Model( new CZPG.Sphere({ radius: 0.01, offset: 3, subdivAixs: 40, subdivHeight: 20 }), quadMaterial );
            sphere.position = [-1, 0, 0];
            scene.add(sphere);

            const gridMaterial = new CZPG.BasicLineMaterial();
            var grid = new CZPG.Model(new CZPG.GridAxis({ size:3, div:1, offset: 2 }), gridMaterial);
            scene.add(grid);

            scene.currentCamera = camera;

            window.loop = new CZPG.Render(function(timespan) {
                if(renderer.fixCanvasToDisplay(window.devicePixelRatio))
                    camera.updateProjMatrix( renderer.canvas.width / renderer.canvas.height );
                cameraControler.update();

                // model.primitive.offset = 3 - 3 * Math.ceil( Math.sin( loop.lastTime * 0.003 ) );
                // cube.primitive.offset = 3 - 3 * Math.ceil( Math.sin( loop.lastTime * 0.003 ) );
                grid.primitive.offset = 2 - 2 * Math.ceil( Math.sin( loop.lastTime * 0.006 ) );

                pointLight.position = [ 1.2 * Math.sin(loop.lastTime * 0.0003) + 1, 1.2 * Math.cos(loop.lastTime * 0.0003), 1.2 * Math.sin(loop.lastTime * 0.0003) ];
                sphere.position = spotLight.position;
                scene.render();
            }).start();

        });

    </script>
</body>
</html>